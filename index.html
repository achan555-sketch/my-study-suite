<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ€ GRX Pro: World All-Stars ğŸ€</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Quicksand:wght@500;700&family=Roboto+Mono:wght@500;700&display=swap');
        :root { 
            --p-light: #ffe5ec; --p-main: #ff8fab; --p-dark: #fb6f92; --bg: #0d0d0d; --card: #1a1a1a;
            --up: #ff3131; --down: #00e676; --text: #ffffff; --gold: #ffd700;
        }
        
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: var(--bg); font-family: 'Quicksand', sans-serif; color: var(--text); }
        
        /* Overlays */
        #start-overlay, #shatter-overlay, #god-overlay { position: fixed; inset: 0; z-index: 2000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        #start-overlay { background: #fff0f3; color: #5c4d50; }
        #shatter-overlay { background: white; opacity: 0; pointer-events: none; z-index: 2500; transition: opacity 0.1s; }
        .shatter-active { opacity: 1 !important; animation: flash 0.5s ease-out; }
        @keyframes flash { 0% { opacity: 1; } 100% { opacity: 0; } }

        #god-overlay { 
            display: none; background: radial-gradient(circle, #1a1a1a 0%, #000 100%); 
            z-index: 3000; border: 10px solid var(--gold); box-sizing: border-box; 
        }
        .god-title { color: var(--gold); font-size: 3rem; font-weight: 700; text-shadow: 0 0 20px var(--gold); margin-bottom: 30px; }
        .god-btns { display: flex; gap: 40px; }
        .god-btn { 
            width: 250px; height: 150px; border: 3px solid var(--gold); background: transparent; 
            color: white; font-family: 'Quicksand'; font-size: 1.5rem; font-weight: 700; cursor: pointer;
            border-radius: 20px; transition: 0.3s; box-shadow: 0 0 15px rgba(255,215,0,0.3);
        }
        .god-btn:hover { background: var(--gold); color: black; box-shadow: 0 0 40px var(--gold); transform: scale(1.1); }
        
        .quote-display { 
            display: none; position: fixed; inset: 0; background: black; z-index: 4000;
            flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 40px;
        }

        /* Layout (Balanced 50:50) */
        .main-container { display: flex; width: 100vw; height: 100vh; padding: 10px; box-sizing: border-box; gap: 10px; }
        .left-panel { flex: 0 0 50%; display: grid; grid-template-columns: 1fr 1fr; grid-template-rows: 1fr 1fr; gap: 8px; }
        .chart-box { background: #000; border-radius: 12px; padding: 8px; border: 1px solid #333; position: relative; aspect-ratio: 1/1; }
        .chart-label { color: #888; font-size: 0.6rem; font-weight: bold; position: absolute; top: 8px; left: 10px; z-index: 5; }
        canvas { width: 100%; height: 100%; }

        .right-panel { flex: 1; display: flex; flex-direction: column; gap: 8px; overflow: hidden; }
        .card { background: var(--card); border-radius: 15px; padding: 10px; border: 1px solid #333; }
        
        .stats-card { display: flex; justify-content: space-between; align-items: center; border-left: 5px solid var(--p-main); }
        .total-asset { font-size: 1.4rem; font-weight: 700; color: var(--p-main); font-family: 'Roboto Mono'; }

        .board-card { background: #000; font-family: 'Roboto Mono'; flex-grow: 1; display: flex; flex-direction: column; padding: 0; overflow: hidden; border: 2px solid #222; border-radius: 15px; }
        .scroll-area { flex-grow: 1; overflow-y: auto; padding: 0 10px; scrollbar-width: none; }
        .board-row { display: flex; justify-content: space-between; height: 18px; align-items: center; font-size: 0.8rem; }
        .ask-price { color: var(--up); font-weight: bold; }
        .bid-price { color: var(--down); font-weight: bold; }
        .mid-price-line { background: #1a1a1a; text-align: center; padding: 5px; border-top: 1px solid #333; border-bottom: 1px solid #333; margin: 4px 0; font-weight: bold; font-size: 1.1rem; }

        .trade-card { display: grid; grid-template-columns: 1fr 1fr; gap: 6px; }
        .btn { border: none; padding: 10px; border-radius: 10px; font-weight: 700; cursor: pointer; color: white; font-family: 'Quicksand'; font-size: 0.85rem; }
        .btn-buy { background: var(--up); }
        .btn-sell { background: var(--down); }

        .ranking-card { font-size: 0.75rem; background: #0a0a0a; border-radius: 15px; height: 140px; overflow-y: auto; flex-shrink: 0; }
        .rank-header { padding: 8px 12px; color: var(--p-main); font-weight: 700; font-size: 0.7rem; border-bottom: 1px solid #222; }
        .rank-list-scroll { overflow-y: auto; flex-grow: 1; scrollbar-width: thin; scrollbar-color: #333 #000; }
        .rank-row { display: flex; justify-content: space-between; padding: 4px 12px; border-bottom: 1px solid #111; }
        .rank-row.me { color: var(--p-main); font-weight: bold; background: rgba(255, 143, 171, 0.1); }
    </style>
</head>
<body>

<div id="start-overlay">
    <span style="font-size:3rem;">ğŸ€</span>
    <h1>GLOBAL RIBBON EXCHANGE</h1>
    <input type="text" id="user-name-input" style="padding:15px; border-radius:15px; border:3px solid var(--p-light); width:300px; font-size:1.3rem; text-align:center; margin-bottom:20px; outline:none;" placeholder="Trader Name" maxlength="10">
    <button onclick="startGame()" style="background:var(--p-dark); color:white; border:none; padding:12px 50px; border-radius:15px; cursor:pointer; font-weight:700; font-size:1.3rem;">START TRADING</button>
</div>

<div id="shatter-overlay"></div>

<div id="god-overlay">
    <div class="god-title">SOVEREIGN MODE</div>
    <p style="font-size:1.2rem; margin-bottom:40px; opacity:0.8;">The world is shattered. Define the new reality.</p>
    <div class="god-btns">
        <button class="god-btn" onclick="divineChoice('ascension')">ASCENSION</button>
        <button class="god-btn" onclick="divineChoice('judgment')">JUDGMENT</button>
    </div>
</div>

<div id="quote-screen" class="quote-display" onclick="location.reload()">
    <h1 id="quote-title" style="font-size:3rem; margin-bottom:20px;"></h1>
    <p id="quote-text" style="font-size:1.5rem; font-style:italic; max-width:800px; color:#aaa;"></p>
    <p style="margin-top:50px; opacity:0.3; font-size:0.8rem;">Click anywhere to return to the world.</p>
</div>

<div class="main-container" id="main-container">
    <div class="left-panel">
        <div class="chart-box"><span class="chart-label">1M (NOW)</span><canvas id="chart1m"></canvas></div>
        <div class="chart-box"><span class="chart-label">5M (SHORT)</span><canvas id="chart5m"></canvas></div>
        <div class="chart-box"><span class="chart-label">DAILY (STATIC)</span><canvas id="chartDaily"></canvas></div>
        <div class="chart-box"><span class="chart-label">WEEKLY (STATIC)</span><canvas id="chartWeekly"></canvas></div>
    </div>

    <div class="right-panel">
        <div class="card stats-card">
            <div><div id="player-name-display" style="font-size:0.6rem; opacity:0.6;">TRADER: achan</div><div class="total-asset"><span id="total-val">100,000.0</span> <small style="font-size:0.6rem;">GRB</small></div></div>
            <div id="rank-display" style="font-size: 0.75rem; font-weight: bold; color: var(--gold);">#?? WORLD</div>
        </div>

        <div class="card board-card">
            <div class="scroll-area">
                <div id="ask-rows"></div><div class="mid-price-line" id="mid-val-display">100.0</div><div id="bid-rows"></div>
            </div>
        </div>

        <div class="card trade-card">
            <button class="btn btn-buy" onclick="trade('buy', 1)">BUY 1</button>
            <button class="btn btn-sell" id="s1" onclick="trade('sell', 1)">SELL 1</button>
            <button class="btn btn-buy" style="opacity:0.8" onclick="trade('buy','max')">ALL IN</button>
            <button class="btn btn-sell" id="smax" style="opacity:0.8" onclick="trade('sell','max')">EXIT ALL</button>
            <div style="grid-column: span 2; font-size:0.65rem; display:flex; justify-content:space-between; opacity:0.6; font-family:'Roboto Mono';">
                <span>CASH: <span id="cash-val">100.0k</span></span><span>HOLD: <span id="hold-val">0</span></span>
            </div>
        </div>

        <div class="card ranking-card">
            <div class="rank-header">ğŸŒ WORLD TOP 30 CHAMPIONSHIP</div>
            <div class="rank-list-scroll" id="ranking-list"></div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<script>
    let userName = " name ", price = 100.0, lastPrice = 100.0, MIN = 70.0, MAX = 130.0;
    let user = { cash: 100000.0, hold: 0 }, hasWon = false;
    let data1m = [], data5m = [], dataDaily = [], dataWeekly = [];
    let tickCount = 0, candle1m = { o:price, h:price, l:price, c:price }, candle5m = { o:price, h:price, l:price, c:price };

    // ğŸ† All-Star Parody Ranking (30 unique names)
    const worldTraders = [
        {n: "Eron Mask ğŸš€", a: 21000000}, {n: "Warren Buffet ğŸ°", a: 15000000}, {n: "Jeff Amazo ğŸ“¦", a: 12000000},
        {n: "Jensen AI ğŸ¤–", a: 8000000}, {n: "Zuck Meta ğŸ‘¥", a: 6000000}, {n: "Bill Windows ğŸ’»", a: 5000000},
        {n: "Bernard Lux ğŸ‘œ", a: 4500000}, {n: "Giraffe Queen ğŸ¦’", a: 3500000}, {n: "Mars Traveler ğŸ›°ï¸", a: 3000000},
        {n: "Ribbon Oracle ğŸ”®", a: 2500000}, {n: "T Elite ğŸ¢", a: 2000000}, {n: "accounitng Master ğŸ’®", a: 1800000},
        {n: "CPA Fighter ğŸ‡ºğŸ‡¸", a: 1600000}, {n: "Trader S ğŸ€", a: 1400000}, {n: "Larry G-Search ğŸ”", a: 1200000},
        {n: "Steve Ball-Dunk ğŸ€", a: 1100000}, {n: "Larry Oracle ğŸ’¾", a: 1000000}, {n: "Michael TV ğŸ“º", a: 950000},
        {n: "Carlos Slim-Line ğŸ“", a: 850000}, {n: "Mukesh Energy ğŸ—ï¸", a: 750000}, {n: "Amancio Zara ğŸ‘•", a: 650000},
        {n: "Night Owl ğŸ¦‰", a: 550000}, {n: "Whale Watching ğŸ³", a: 450000}, {n: "Coffee Addict â˜•", a: 350000},
        {n: "Lucky Girl âœ¨", a: 300000}, {n: "Fearless ğŸ’ƒ", a: 250000}, {n: "Smart AI ğŸ¦¾", a: 200000},
        {n: "abc ğŸ¤–", a: 150000}, {n: "Empty Pocket ğŸ’¸", a: 100000}, {n: "Paper Hands ğŸ“„", a: 80000}
    ];

    function preGenerateData() {
        let p = price;
        for(let i=0; i<30; i++) {
            p = Math.max(MIN, Math.min(MAX, p + (Math.random()-0.5)*3));
            data1m.push({o:p, h:p+0.5, l:p-0.5, c:p});
        }
        for(let i=0; i<30; i++) {
            p = Math.max(MIN, Math.min(MAX, p + (Math.random()-0.5)*5));
            data5m.push({o:p, h:p+1, l:p-1, c:p});
        }
        p = price;
        for(let i=0; i<30; i++) {
            let o = p + (Math.random()-0.5)*8; let c = o + (Math.random()-0.5)*12;
            dataDaily.push({o:o, h:Math.max(o,c)+2, l:Math.min(o,c)-2, c:c}); p = c;
        }
        p = price;
        for(let i=0; i<30; i++) {
            let o = p + (Math.random()-0.5)*15; let c = o + (Math.random()-0.5)*25;
            dataWeekly.push({o:o, h:Math.max(o,c)+5, l:Math.min(o,c)-5, c:c}); p = c;
        }
        price = data1m[data1m.length-1].c;
    }

    function startGame() {
        userName = document.getElementById('user-name-input').value || "Trader";
        document.getElementById('player-name-display').innerText = `TRADER: ${userName}`;
        document.getElementById('start-overlay').style.display = 'none';
        preGenerateData(); setInterval(updateMarket, 600);
    }

    function updateMarket() {
        if(hasWon) return;
        lastPrice = price;
        price = Math.max(MIN, Math.min(MAX, price + (Math.random()-0.5)*3.5));
        tickCount++;
        candle1m.h = Math.max(candle1m.h, price); candle1m.l = Math.min(candle1m.l, price); candle1m.c = price;
        if (tickCount % 5 === 0) {
            data1m.push({...candle1m}); if(data1m.length>30) data1m.shift();
            candle5m.h = Math.max(candle5m.h, candle1m.h); candle5m.l = Math.min(candle5m.l, candle1m.l); candle5m.c = candle1m.c;
            if(tickCount === 5) candle5m.o = candle1m.o;
            candle1m = { o:price, h:price, l:price, c:price };
        }
        if (tickCount % 25 === 0) { data5m.push({...candle5m}); if(data5m.length>30) data5m.shift(); candle5m = { o:price, h:price, l:price, c:price }; tickCount = 0; }
        drawAllCharts(); drawBoard(); updateUI();
    }

    function drawCandles(id, data, forming = null) {
        const c = document.getElementById(id); const ctx = c.getContext('2d');
        const w = c.width = c.offsetWidth * 2; const h = c.height = c.offsetHeight * 2;
        ctx.scale(2,2); const cw = w/2, ch = h/2; ctx.clearRect(0,0,cw,ch);
        const drawData = [...data]; if(forming) drawData.push(forming);
        if(drawData.length === 0) return;
        let minV = drawData[0].l, maxV = drawData[0].h;
        drawData.forEach(d => { minV = Math.min(minV, d.l); maxV = Math.max(maxV, d.h); });
        let range = (maxV - minV) || 1; let pad = range * 0.15;
        const getY = (val) => ch - ((val - (minV - pad)) / (range + pad * 2)) * ch;
        const space = cw / 35;
        drawData.forEach((d, i) => {
            const x = i * space + (cw - drawData.length * space); 
            const up = d.c >= d.o, color = up ? '#ff3131' : '#00e676';
            ctx.strokeStyle = color; ctx.lineWidth = 1.2;
            ctx.beginPath(); ctx.moveTo(x, getY(d.h)); ctx.lineTo(x, getY(d.l)); ctx.stroke();
            ctx.fillStyle = color; ctx.fillRect(x - 3, getY(Math.max(d.o, d.c)), 6, Math.max(2, Math.abs(getY(d.o) - getY(d.c))));
        });
    }

    function drawAllCharts() { drawCandles('chart1m', data1m, candle1m); drawCandles('chart5m', data5m, candle5m); drawCandles('chartDaily', dataDaily); drawCandles('chartWeekly', dataWeekly); }

    function drawBoard() {
        let askH = '', bidH = '';
        for(let i=10; i>=1; i--) askH += `<div class="board-row"><span class="ask-price">${(price + i*0.1).toFixed(1)}</span><span style="color:#444">${Math.floor(Math.random()*900+50)}</span></div>`;
        for(let i=1; i<=10; i++) bidH += `<div class="board-row"><span class="bid-price">${(price - i*0.1).toFixed(1)}</span><span style="color:#444">${Math.floor(Math.random()*900+50)}</span></div>`;
        document.getElementById('ask-rows').innerHTML = askH; document.getElementById('bid-rows').innerHTML = bidH;
        const mv = document.getElementById('mid-val-display'); mv.innerText = price.toFixed(1); mv.style.color = price >= lastPrice ? 'var(--up)' : 'var(--down)';
    }

    function updateUI() {
        const total = user.cash + (user.hold * price);
        document.getElementById('total-val').innerText = total.toLocaleString(undefined, {minimumFractionDigits: 1});
        document.getElementById('cash-val').innerText = (user.cash/1000).toFixed(1) + 'k';
        document.getElementById('hold-val').innerText = user.hold;
        
        // ğŸ† Dynamic Ranking merging User
        const all = [...worldTraders, {n: userName, a: total, me: true}].sort((a,b) => b.a - a.a);
        const myRank = all.findIndex(t => t.me) + 1;
        document.getElementById('rank-display').innerText = `#${myRank} WORLD`;
        
        if (myRank === 1 && !hasWon) triggerSovereignMode();
        
        let listH = ''; 
        // Show Top 30
        all.slice(0, 30).forEach((l, i) => {
            listH += `<div class="rank-row ${l.me?'me':''}"><span>${i+1}. ${l.n}</span><span>${Math.floor(l.a).toLocaleString()}</span></div>`;
        });
        document.getElementById('ranking-list').innerHTML = listH;
        
        document.getElementById('s1').disabled = user.hold < 1; 
        document.getElementById('smax').disabled = user.hold < 1;
    }

    function triggerSovereignMode() {
        hasWon = true;
        document.getElementById('shatter-overlay').classList.add('shatter-active');
        setTimeout(() => {
            document.getElementById('main-container').style.filter = 'blur(10px)';
            document.getElementById('god-overlay').style.display = 'flex';
            confetti({ particleCount: 200, spread: 70, origin: { y: 0.6 } });
        }, 300);
    }

    const quotes = {
        ascension: [
            "True sovereignty is not in winning the game, but in writing the rules.",
            "Markets are made by the daring, and inherited by the wise.",
            "Greatness begins when you stop following the trend and start becoming it."
        ],
        judgment: [
            "Even a king is a servant to time.",
            "To reach the stars, one must first embrace the abyss.",
            "Hubris is the tax paid by the powerful."
        ]
    };

    function divineChoice(type) {
        const isJudgment = (type === 'judgment');
        document.getElementById('quote-screen').style.display = 'flex';
        document.getElementById('quote-title').innerText = type.toUpperCase();
        document.getElementById('quote-title').style.color = isJudgment ? 'var(--up)' : 'var(--gold)';
        const pool = isJudgment ? quotes.judgment : quotes.ascension;
        document.getElementById('quote-text').innerText = pool[Math.floor(Math.random()*pool.length)];
    }

    function trade(type, amt) {
        let qty = (amt === 'max') ? (type === 'buy' ? Math.floor(user.cash / price) : user.hold) : amt;
        if (type === 'buy' && user.cash >= price * qty && qty > 0) { user.cash -= price * qty; user.hold += qty; }
        else if (type === 'sell' && user.hold >= qty && qty > 0) { user.hold -= qty; user.cash += price * qty; }
        updateUI();
    }
</script>
</body>
</html>
