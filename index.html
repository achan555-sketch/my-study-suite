<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéÄ achan's Ultimate Suite v8 üéÄ</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Quicksand:wght@300;500;700&display=swap');
        :root { --pink-light: #ffe5ec; --pink-main: #ff8fab; --pink-dark: #fb6f92; --bg: #fff0f3; --text: #5c4d50; }
        
        body { 
            background: var(--bg); color: var(--text); font-family: 'Quicksand', sans-serif; 
            margin: 0; padding: 20px; display: flex; justify-content: center; 
            background-image: radial-gradient(var(--pink-light) 1px, transparent 1px);
            background-size: 20px 20px;
        }

        .wrapper { width: 100%; max-width: 500px; }
        header { text-align: center; margin-bottom: 30px; }
        h1 { font-weight: 700; color: var(--pink-dark); letter-spacing: 2px; }
        .ribbon-icon { font-size: 2.2rem; display: block; animation: float 3s ease-in-out infinite; }
        @keyframes float { 50% { transform: translateY(-8px); } }

        /* Exam Card with Glassmorphism */
        .exam-card { 
            background: rgba(255, 255, 255, 0.9); 
            backdrop-filter: blur(10px);
            border-radius: 35px; padding: 25px; 
            box-shadow: 0 15px 35px rgba(255, 143, 171, 0.2); 
            margin-bottom: 30px; border: 3px solid white;
        }

        .exam-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .exam-title { font-size: 1.3rem; font-weight: 700; color: var(--pink-dark); }
        .countdown { font-size: 0.75rem; background: var(--pink-light); color: var(--pink-dark); padding: 6px 15px; border-radius: 20px; font-weight: bold; }

        .overall-section { background: #fffcfd; padding: 20px; border-radius: 25px; border: 1px solid var(--pink-light); margin: 15px 0; }
        .bar-outer { background: var(--pink-light); height: 16px; border-radius: 10px; overflow: hidden; margin-top: 10px; }
        .bar-inner { background: linear-gradient(90deg, var(--pink-main), var(--pink-dark)); height: 100%; width: 0%; transition: 1s cubic-bezier(0.18, 0.89, 0.32, 1.28); }

        .task-item { margin-top: 25px; padding: 20px; background: white; border-radius: 25px; border: 2px solid var(--pink-light); position: relative; }
        .percent-badge { position: absolute; top: -12px; right: 20px; background: var(--pink-dark); color: white; padding: 4px 14px; border-radius: 12px; font-size: 0.75rem; font-weight: bold; }

        /* History & Daily Log */
        .daily-log-zone { background: #fffcfd; border-radius: 20px; padding: 15px; margin-top: 15px; border: 1px dashed var(--pink-main); }
        .history-tag { font-size: 0.65rem; color: var(--pink-main); margin-bottom: 5px; display: block; font-weight: 700; }
        .log-input-row { display: flex; gap: 8px; align-items: center; }
        .input-mini { width: 70px; padding: 8px; border: 2px solid var(--pink-light); border-radius: 12px; text-align: center; font-family: 'Quicksand'; font-weight: 700; color: var(--pink-dark); outline: none; }
        
        button { cursor: pointer; border: none; font-family: 'Quicksand'; transition: 0.3s; }
        .btn-add-log { background: var(--pink-dark); color: white; padding: 10px 15px; border-radius: 12px; font-weight: 700; font-size: 0.8rem; flex-grow: 1; }
        .btn-undo { background: var(--pink-light); color: var(--pink-dark); padding: 10px; border-radius: 12px; font-size: 0.8rem; width: 40px; }
        .btn-undo:hover { filter: brightness(0.95); }

        .add-zone, .reward-manager { background: white; padding: 30px; border-radius: 35px; border: 3px solid var(--pink-light); margin-top: 30px; box-shadow: 0 10px 20px rgba(0,0,0,0.02); }
        input[type="text"], .date-input, select { width: 100%; padding: 15px; border-radius: 20px; border: 2px solid var(--pink-light); margin-bottom: 12px; box-sizing: border-box; font-family: 'Quicksand'; outline: none; }
        .btn-main { background: var(--pink-dark); color: white; padding: 18px; border-radius: 25px; font-weight: 700; width: 100%; font-size: 1rem; }
    </style>
</head>
<body>

<div class="wrapper">
    <header><span class="ribbon-icon">üéÄ</span><h1>study Dashboard v8</h1></header>

    <div id="dashboard"></div>

    <div class="add-zone">
        <h3 style="text-align:center; color:var(--pink-dark); margin:0 0 20px;">‚ú® New Goal ‚ú®</h3>
        <input type="text" id="new-name" placeholder="Exam Name">
        <input type="text" id="new-date" class="date-input" placeholder="Deadline Date">
        <select id="reward-select"><option value="">-- Choose Reward üéÅ --</option></select>
        <button class="btn-main" onclick="addProject()">Create Goal üéÄ</button>
    </div>

    <div class="reward-manager">
        <h3 style="color:var(--pink-dark); margin:0 0 15px; font-size:1rem;">üé® My Reward List</h3>
        <div style="display:flex; gap:10px;">
            <input type="text" id="pool-input" placeholder="Add new reward..." style="margin:0;">
            <button class="btn-main" style="width:80px; padding:10px;" onclick="addToPool()">Add</button>
        </div>
        <div id="pool-display" style="display:flex; flex-wrap:wrap; gap:8px; margin-top:15px;"></div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<script>
    flatpickr(".date-input", { dateFormat: "Y-m-d", minDate: "today", disableMobile: true });

    let projects = JSON.parse(localStorage.getItem('achan_v8_data')) || [];
    let rewardPool = JSON.parse(localStorage.getItem('achan_v8_pool')) || ["New Lip Tint üíÑ", "Shopping üõçÔ∏è"];
    let lastAction = null; // UndoÁî®„ÅÆÂ±•Ê≠¥

    function save() {
        localStorage.setItem('achan_v8_data', JSON.stringify(projects));
        localStorage.setItem('achan_v8_pool', JSON.stringify(rewardPool));
        render();
        updatePoolUI();
    }

    function addToPool() {
        const val = document.getElementById('pool-input').value;
        if (val) { rewardPool.push(val); document.getElementById('pool-input').value = ''; save(); }
    }

    function removePoolItem(idx) { rewardPool.splice(idx, 1); save(); }

    function updatePoolUI() {
        const display = document.getElementById('pool-display');
        const select = document.getElementById('reward-select');
        display.innerHTML = '';
        let options = '<option value="">-- Choose Reward üéÅ --</option>';
        rewardPool.forEach((r, i) => {
            options += `<option value="${r}">${r}</option>`;
            display.innerHTML += `<div style="background:var(--pink-light); color:var(--pink-dark); padding:6px 12px; border-radius:12px; font-size:0.75rem; font-weight:700;">${r} <span onclick="removePoolItem(${i})" style="cursor:pointer; opacity:0.5;">‚úï</span></div>`;
        });
        select.innerHTML = options;
    }

    function addProject() {
        const name = document.getElementById('new-name').value;
        const date = document.getElementById('new-date').value;
        const reward = document.getElementById('reward-select').value;
        if (!name || !date || !reward) return alert("Please fill in the blanks! üéÄ");
        projects.push({ id: Date.now(), name, date, reward, history: "", tasks: [{ id: 1, name: "Practice MCQ", current: 0, goal: 100 }, { id: 2, name: "Chapters", current: 0, goal: 10 }] });
        save();
    }

    // --- Êó•Ê¨°ÂÆüÁ∏æ„ÅÆ„É≠„Ç∞„Å®UndoÊ©üËÉΩ ---
    function logDaily(pId, tId) {
        const input = document.getElementById(`log-${pId}-${tId}`);
        const val = parseInt(input.value) || 0;
        if (val <= 0) return;

        // ‰øùÂ≠òÂâç„Å´„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„Çí„Å®„Çã
        lastAction = { pId, tId, val, prevState: JSON.parse(JSON.stringify(projects)) };

        const p = projects.find(x => x.id === pId);
        const t = p.tasks.find(x => x.id === tId);
        t.current = Math.min(t.goal, t.current + val);
        p.history = `Last: +${val}`; // Â±•Ê≠¥„ÇíË°®Á§∫
        input.value = '';

        if (t.current === t.goal) confetti({ particleCount: 150, spread: 70, colors: ['#ff8fab', '#fb6f92'] });
        save();
    }

    function undoLast() {
        if (!lastAction) return alert("Nothing to undo! üéÄ");
        projects = lastAction.prevState;
        lastAction = null;
        save();
    }

    function updateGoal(pId, tId, val) {
        const p = projects.find(x => x.id === pId);
        const t = p.tasks.find(x => x.id === tId);
        t.goal = Math.max(1, parseInt(val) || 1);
        save();
    }

    function deleteProject(id) { if (confirm("Remove this goal?")) { projects = projects.filter(x => x.id !== id); save(); } }

    function render() {
        const dash = document.getElementById('dashboard'); dash.innerHTML = '';
        projects.forEach(proj => {
            const days = Math.max(0, Math.ceil((new Date(proj.date) - new Date()) / 86400000));
            let tHtml = '', tCur = 0, tGoal = 0;
            proj.tasks.forEach(task => {
                tCur += task.current; tGoal += task.goal;
                const p = Math.round((task.current / task.goal) * 100) || 0;
                tHtml += `
                <div class="task-item">
                    <span class="percent-badge">${p}% Done</span>
                    <div style="display:flex; justify-content:space-between; font-weight:700; font-size:0.9rem;">
                        <span>${task.name} üéÄ</span>
                        <span>${task.current} / <input type="number" class="input-mini" value="${task.goal}" onchange="updateGoal(${proj.id}, ${task.id}, this.value)"></span>
                    </div>
                    <div class="daily-log-zone">
                        <span class="history-tag">${proj.history || 'No entry yet'}</span>
                        <div class="log-input-row">
                            <input type="number" id="log-${proj.id}-${task.id}" class="input-mini" placeholder="+0">
                            <button class="btn-add-log" onclick="logDaily(${proj.id}, ${task.id})">Add</button>
                            <button class="btn-undo" onclick="undoLast()">‚§∫</button>
                        </div>
                    </div>
                </div>`;
            });
            const overP = tGoal > 0 ? Math.round((tCur / tGoal) * 100) : 0;
            dash.innerHTML += `
            <div class="exam-card">
                <div class="exam-header"><div style="font-weight:700; font-size:1.3rem; color:var(--pink-dark);">${proj.name}</div><span class="countdown">‚ú® ${days} Days ‚ú®</span></div>
                <div style="font-size:0.8rem; color:var(--pink-main); text-align:center; margin:10px 0;">üéÅ Reward: ${proj.reward}</div>
                <div class="overall-section">
                    <div style="display:flex; justify-content:space-between; font-size:0.85rem; font-weight:700;"><span>Total Progress</span><span>${overP}%</span></div>
                    <div class="bar-outer"><div class="bar-inner" style="width:${overP}%"></div></div>
                </div>
                ${tHtml}
                <button onclick="deleteProject(${proj.id})" style="background:none; border:none; color:#ccc; text-decoration:underline; font-size:0.7rem; margin-top:20px; width:100%; cursor:pointer;">remove</button>
            </div>`;
        });
    }

    window.onload = () => { updatePoolUI(); render(); };
</script>
</body>
</html>
