<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸŽ€ GRX Pro: Final Sovereign v26 ðŸŽ€</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Quicksand:wght@500;700&family=Roboto+Mono:wght@500;700&display=swap');
        :root { 
            --p-light: #ffe5ec; --p-main: #ff8fab; --p-dark: #fb6f92; --bg: #0d0d0d; --card: #1a1a1a;
            --up: #ff3131; --down: #00e676; --text: #ffffff; --gold: #ffd700;
        }
        
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: var(--bg); font-family: 'Quicksand', sans-serif; color: var(--text); }
        
        /* Shatter Pieces */
        .shatter-piece { position: fixed; background: rgba(255,255,255,0.8); z-index: 5000; pointer-events: none; }

        /* Overlays */
        #start-overlay, #god-overlay { position: fixed; inset: 0; z-index: 2000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        #start-overlay { background: #fff0f3; color: #5c4d50; }

        #god-overlay { 
            display: none; background: radial-gradient(circle, #1a1a1a 0%, #000 100%); 
            z-index: 3000; border: 15px solid var(--gold); box-sizing: border-box; 
        }
        .god-title { color: var(--gold); font-size: 3.5rem; font-weight: 700; text-shadow: 0 0 30px var(--gold); margin-bottom: 30px; }
        .god-btns { display: flex; gap: 50px; }
        .god-btn { 
            width: 280px; height: 180px; border: 4px solid var(--gold); background: transparent; 
            color: white; font-family: 'Quicksand'; font-size: 1.8rem; font-weight: 700; cursor: pointer;
            border-radius: 25px; transition: 0.3s;
        }
        .god-btn:hover { background: var(--gold); color: black; transform: scale(1.1); box-shadow: 0 0 50px var(--gold); }
        
        .quote-display { 
            display: none; position: fixed; inset: 0; background: black; z-index: 4000;
            flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 50px;
        }

        /* Standard Game Layout */
        .main-container { display: flex; width: 100vw; height: 100vh; padding: 10px; box-sizing: border-box; gap: 10px; transition: 0.5s; }
        .left-panel { flex: 0 0 50%; display: grid; grid-template-columns: 1fr 1fr; grid-template-rows: 1fr 1fr; gap: 8px; }
        .chart-box { background: #000; border-radius: 12px; padding: 8px; border: 1px solid #333; position: relative; aspect-ratio: 1/1; }
        .chart-label { color: #888; font-size: 0.6rem; font-weight: bold; position: absolute; top: 8px; left: 10px; z-index: 5; }
        canvas { width: 100%; height: 100%; }

        .right-panel { flex: 1; display: flex; flex-direction: column; gap: 8px; overflow: hidden; }
        .card { background: var(--card); border-radius: 15px; padding: 12px; border: 1px solid #333; }
        .total-asset { font-size: 1.5rem; font-weight: 700; color: var(--p-main); font-family: 'Roboto Mono'; }

        .board-card { background: #000; font-family: 'Roboto Mono'; flex-grow: 1; display: flex; flex-direction: column; padding: 0; overflow: hidden; border: 2px solid #222; border-radius: 15px; }
        .scroll-area { flex-grow: 1; overflow-y: auto; padding: 0 10px; scrollbar-width: none; }
        .board-row { display: flex; justify-content: space-between; height: 18px; align-items: center; font-size: 0.8rem; }
        .mid-price-line { background: #1a1a1a; text-align: center; padding: 8px; border-top: 1px solid #333; border-bottom: 1px solid #333; margin: 5px 0; font-weight: bold; font-size: 1.2rem; }

        .trade-card { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .btn { border: none; padding: 12px; border-radius: 12px; font-weight: 700; cursor: pointer; color: white; font-family: 'Quicksand'; font-size: 1rem; }
    </style>
</head>
<body>

<div id="start-overlay">
    <span style="font-size:3rem;">ðŸŽ€</span>
    <h1>GLOBAL RIBBON EXCHANGE</h1>
    <input type="text" id="user-name-input" style="padding:15px; border-radius:15px; border:3px solid var(--p-light); width:300px; font-size:1.3rem; text-align:center; margin-bottom:20px; outline:none;" placeholder="Trader Name" maxlength="10">
    <button onclick="startGame()" style="background:var(--p-dark); color:white; border:none; padding:12px 50px; border-radius:15px; cursor:pointer; font-weight:700; font-size:1.3rem;">START TRADING</button>
</div>

<div id="god-overlay">
    <div class="god-title">THE SOVEREIGN PATH</div>
    <p style="font-size:1.4rem; margin-bottom:40px; color:rgba(255,255,255,0.6);">The world has shattered. Choose your legacy.</p>
    <div class="god-btns">
        <button class="god-btn" onclick="divineChoice(0)">PATH ALPHA</button>
        <button class="god-btn" onclick="divineChoice(1)">PATH OMEGA</button>
    </div>
</div>

<div id="quote-screen" class="quote-display">
    <h1 id="quote-title" style="font-size:3.5rem; margin-bottom:20px; text-shadow: 0 0 20px rgba(255,255,255,0.5);"></h1>
    <p id="quote-text" style="font-size:1.8rem; font-style:italic; max-width:900px; color:#ccc; line-height:1.5;"></p>
    <button onclick="location.reload()" style="margin-top:50px; background:var(--gold); border:none; padding:15px 40px; border-radius:15px; font-weight:700; cursor:pointer;">RETURN TO THE WORLD</button>
</div>

<div class="main-container" id="main-container">
    <div class="left-panel">
        <div class="chart-box"><span class="chart-label">1M (NOW)</span><canvas id="chart1m"></canvas></div>
        <div class="chart-box"><span class="chart-label">5M (SHORT)</span><canvas id="chart5m"></canvas></div>
        <div class="chart-box"><span class="chart-label">DAILY (STATIC)</span><canvas id="chartDaily"></canvas></div>
        <div class="chart-box"><span class="chart-label">WEEKLY (STATIC)</span><canvas id="chartWeekly"></canvas></div>
    </div>

    <div class="right-panel">
        <div class="card" style="display:flex; justify-content:space-between; align-items:center; border-left:5px solid var(--p-main);">
            <div><div id="player-name-display" style="font-size:0.6rem; opacity:0.6;">TRADER: achan</div><div class="total-asset"><span id="total-val">100,000.0</span> <small style="font-size:0.7rem;">GRB</small></div></div>
            <div id="rank-display" style="font-size: 0.8rem; font-weight: bold; color: var(--gold);">#?? WORLD</div>
        </div>
        <div class="card board-card">
            <div class="scroll-area"><div id="ask-rows"></div><div class="mid-price-line" id="mid-val-display">100.0</div><div id="bid-rows"></div></div>
        </div>
        <div class="card trade-card">
            <button class="btn" style="background:var(--up)" onclick="trade('buy', 1)">BUY 1</button>
            <button class="btn" style="background:var(--down)" onclick="trade('sell', 1)">SELL 1</button>
            <button class="btn" style="background:var(--up); opacity:0.8" onclick="trade('buy','max')">ALL IN</button>
            <button class="btn" style="background:var(--down); opacity:0.8" onclick="trade('sell','max')">EXIT ALL</button>
            <div style="grid-column: span 2; font-size:0.7rem; display:flex; justify-content:space-between; opacity:0.6; font-family:'Roboto Mono';">
                <span>CASH: <span id="cash-val">100.0k</span></span><span>HOLD: <span id="hold-val">0</span></span>
            </div>
        </div>
        <div class="card" style="font-size:0.75rem; background:#0a0a0a; border-radius:15px; height:140px; overflow-y:auto; flex-shrink:0;">
            <div id="ranking-list"></div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<script>
    let userName = "achan", price = 100.0, lastPrice = 100.0, user = { cash: 100000.0, hold: 0 }, hasWon = false;
    let data1m = [], data5m = [], dataDaily = [], dataWeekly = [], tickCount = 0;
    let candle1m = { o:price, h:price, l:price, c:price }, candle5m = { o:price, h:price, l:price, c:price };
    const worldTraders = [{n: "Eron Mask ðŸš€", a: 21000000}, {n: "Warren Buffet ðŸ°", a: 15000000}, {n: "Jeff Amazo ðŸ“¦", a: 12000000}].concat(Array.from({length:27}, (_,i) => ({n:`Trader-${i+1}`, a: (20-i)*150000})));

    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playSound(freq, type, duration) {
        const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain();
        osc.type = type; osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
        gain.gain.setValueAtTime(0.1, audioCtx.currentTime); gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
        osc.connect(gain); gain.connect(audioCtx.destination); osc.start(); osc.stop(audioCtx.currentTime + duration);
    }

    function createShatter() {
        for (let i = 0; i < 40; i++) {
            const piece = document.createElement('div'); piece.className = 'shatter-piece';
            const size = Math.random() * 50 + 20; piece.style.width = size + 'px'; piece.style.height = size + 'px';
            piece.style.left = Math.random() * 100 + 'vw'; piece.style.top = Math.random() * 100 + 'vh';
            document.body.appendChild(piece);
            piece.animate([ { transform: 'translate(0,0) rotate(0deg)', opacity: 1 }, 
                { transform: `translate(${(Math.random()-0.5)*1000}px, ${(Math.random()-0.5)*1000}px) rotate(${Math.random()*720}deg)`, opacity: 0 }
            ], { duration: 1000, easing: 'ease-out', fill: 'forwards' });
            setTimeout(() => piece.remove(), 1000);
        }
        playSound(200, 'square', 0.2); playSound(100, 'sawtooth', 0.3);
    }

    function startGame() {
        userName = document.getElementById('user-name-input').value || "Trader";
        document.getElementById('player-name-display').innerText = `TRADER: ${userName}`;
        document.getElementById('start-overlay').style.display = 'none';
        preGen(); setInterval(update, 600);
        window.addEventListener('keydown', (e) => { if(e.key.toLowerCase() === 'v') { user.cash = 100000000; updateUI(); } });
    }

    function preGen() {
        let p = price;
        for(let i=0; i<30; i++) { p += (Math.random()-0.5)*3; data1m.push({o:p, h:p+0.5, l:p-0.5, c:p}); }
        for(let i=0; i<30; i++) { p += (Math.random()-0.5)*8; dataDaily.push({o:p, h:p+2, l:p-2, c:p}); }
        for(let i=0; i<30; i++) { p += (Math.random()-0.5)*15; dataWeekly.push({o:p, h:p+5, l:p-5, c:p}); }
    }

    function update() {
        if(hasWon) return; lastPrice = price; price += (Math.random()-0.5)*3.5; tickCount++;
        candle1m.h = Math.max(candle1m.h, price); candle1m.l = Math.min(candle1m.l, price); candle1m.c = price;
        if (tickCount % 5 === 0) {
            data1m.push({...candle1m}); if(data1m.length>30) data1m.shift();
            candle5m.h = Math.max(candle5m.h, candle1m.h); candle5m.l = Math.min(candle5m.l, candle1m.l); candle5m.c = candle1m.c;
            if(tickCount === 5) candle5m.o = candle1m.o; candle1m = { o:price, h:price, l:price, c:price };
        }
        if (tickCount % 25 === 0) { data5m.push({...candle5m}); if(data5m.length>30) data5m.shift(); candle5m = { o:price, h:price, l:price, c:price }; tickCount = 0; }
        draw(); updateUI();
    }

    function draw() {
        ['chart1m','chart5m','chartDaily','chartWeekly'].forEach(id => {
            const c = document.getElementById(id), ctx = c.getContext('2d');
            const w = c.width = c.offsetWidth * 2, h = c.height = c.offsetHeight * 2; ctx.scale(2,2); ctx.clearRect(0,0,w/2,h/2);
            let d = (id==='chart1m')?data1m:(id==='chart5m')?data5m:(id==='chartDaily')?dataDaily:dataWeekly;
            if(!d.length) return; let minV = Math.min(...d.map(v=>v.l)), maxV = Math.max(...d.map(v=>v.h)), range = (maxV-minV)||1;
            const getY = (val) => (h/2) - ((val - (minV - range*0.15)) / (range * 1.3)) * (h/2);
            d.forEach((v, i) => {
                const x = i * (w/70) + (w/4 - d.length*(w/140)); const up = v.c >= v.o, col = up ? '#ff3131' : '#00e676';
                ctx.strokeStyle = col; ctx.beginPath(); ctx.moveTo(x, getY(v.h)); ctx.lineTo(x, getY(v.l)); ctx.stroke();
                ctx.fillStyle = col; ctx.fillRect(x-3, getY(Math.max(v.o, v.c)), 6, Math.max(2, Math.abs(getY(v.o)-getY(v.c))));
            });
        });
        document.getElementById('mid-val-display').innerText = price.toFixed(1);
    }

    function updateUI() {
        const total = user.cash + (user.hold * price);
        document.getElementById('total-val').innerText = total.toLocaleString(undefined, {minimumFractionDigits:1});
        const all = [...worldTraders, {n: userName, a: total, me: true}].sort((a,b) => b.a - a.a);
        const myRank = all.findIndex(t => t.me) + 1;
        document.getElementById('rank-display').innerText = `#${myRank} WORLD`;
        if (myRank === 1 && !hasWon) {
            hasWon = true; createShatter();
            setTimeout(() => { document.getElementById('main-container').style.filter = 'blur(15px)'; document.getElementById('god-overlay').style.display = 'flex'; }, 600);
        }
        let listH = ''; all.slice(0, 30).forEach((l, i) => { listH += `<div style="display:flex; justify-content:space-between; padding:5px 12px; border-bottom:1px solid #222; ${l.me?'color:var(--p-main); font-weight:bold; background:rgba(255,143,171,0.1);':''}"><span>${i+1}. ${l.n}</span><span>${Math.floor(l.a).toLocaleString()}</span></div>`; });
        document.getElementById('ranking-list').innerHTML = listH;
    }

    const quotes = [
        {t:"ASCENSION", c:"True sovereignty is not in winning the game, but in writing the rules.", s:[440, 660, 880]},
        {t:"JUDGMENT", c:"Even a king is a servant to time. The abyss awaits.", s:[220, 110, 55]}
    ];
    let pathMap = [0, 1].sort(() => Math.random() - 0.5);

    function divineChoice(btnIdx) {
        const result = quotes[pathMap[btnIdx]];
        document.getElementById('quote-screen').style.display = 'flex';
        document.getElementById('quote-title').innerText = result.t;
        document.getElementById('quote-title').style.color = (result.t === 'JUDGMENT') ? 'var(--up)' : 'var(--gold)';
        document.getElementById('quote-text').innerText = result.c;
        result.s.forEach((f, i) => setTimeout(() => playSound(f, 'sine', 0.5), i * 200));
        if(result.t === 'ASCENSION') confetti({ particleCount: 400, spread: 100, origin: { y: 0.6 } });
    }

    function trade(type, amt) {
        let qty = (amt === 'max') ? (type === 'buy' ? Math.floor(user.cash / price) : user.hold) : amt;
        if (type === 'buy' && user.cash >= price * qty) { user.cash -= price * qty; user.hold += qty; }
        else if (type === 'sell' && user.hold >= qty) { user.hold -= qty; user.cash += price * qty; }
        updateUI();
    }
</script>
</body>
</html>
